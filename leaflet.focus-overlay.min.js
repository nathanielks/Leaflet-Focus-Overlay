L.FocusOverlay=L.Class.extend({includes:L.Mixin.Events,options:{duration:250,easing:"ease"},initialize:function(e,t){this._size=L.point(e);this._positionSet=!1;this._opacity=0;L.Util.setOptions(this,t)},onAdd:function(e){this._map=e;this._overlay||this._initOverlay();e._panes.overlayPane.appendChild(this._overlay);e.on("viewreset dragend",this._reset,this);e.on("popupopen",this._setPopupLatLng,this);e.on("popupopen",this.fadeIn,this);e.on("dragstart click popupclose",this.fadeOut,this);e.on("dragstart click",this._removeTransition,this);this.on("moveend",this._addTransition,this);this._reset()},onRemove:function(e){e.getPanes().overlayPane.removeChild(this._overlay);e.off("viewreset",this._reset,this)},addTo:function(e){e.addLayer(this);return this},setOpacity:function(e){this._opacity=e;this._updateOpacity();return this},fadeIn:function(){this.setOpacity(1).setViewToPopup(this._map.currentPoint).moveToPoint(this._map.currentPoint)._addTransition();return this},fadeOut:function(){this.setOpacity(0);return this},moveToPoint:function(e){var t=this._map.latLngToLayerPoint(e);this._moveToPoint(t);return this},_addTransition:function(){this._overlay.style[L.Transition.DURATION]=this.options.duration+"ms";this._overlay.style[L.Transition.EASING]=this.options.easing;this._overlay.style[L.Transition.PROPERTY]="all"},_removeTransition:function(){this._overlay.style[L.Transition.PROPERTY]="opacity"},_moveToPoint:function(e){L.DomUtil.setPosition(this._overlay,e);this.fire("moveend");return this},_initOverlay:function(){this._overlay=L.DomUtil.create("div","leaflet-focus-overlay");this._overlay.top=L.DomUtil.create("div","overlay-top",this._overlay);this._overlay.middle=L.DomUtil.create("div","overlay-middle",this._overlay);this._overlay.middle.left=L.DomUtil.create("div","overlay-left",this._overlay.middle);this._overlay.image=L.DomUtil.create("div","overlay-center",this._overlay.middle);this._overlay.middle.right=L.DomUtil.create("div","overlay-right",this._overlay.middle);this._overlay.bottom=L.DomUtil.create("div","overlay-bottom",this._overlay);this._updateOpacity()},_getViewCenter:function(){this._map.viewCenter=this._map.getCenter()},_reset:function(){L.DomUtil.setPosition(this._overlay,this._map.latLngToLayerPoint(this._map.getCenter()))},_setPopupLatLng:function(e){var t=e.popup._latlng.lat,n=e.popup._latlng.lng,r=new L.LatLng(t,n);this._map.currentPoint=r;return r},setViewToPopup:function(e){this._map.setView(e,this._map.getZoom());return this},_updateOpacity:function(){L.DomUtil.setOpacity(this._overlay,this._opacity)}});L.focusOverlay=function(){return new L.FocusOverlay};