L.FocusOverlay=L.Class.extend({includes:L.Mixin.Events,options:{opacity:0},initialize:function(e,t,n){this._url=e;this._size=L.point(t);this._positionSet=!1;L.Util.setOptions(this,n)},onAdd:function(e){this._map=e;this._overlay||this._initOverlay();e._panes.overlayPane.appendChild(this._overlay);e.on("viewreset dragend",this._reset,this);e.on("popupopen",this._setViewToPopup,this);e.on("popupopen",this.fadeIn,this);e.on("dragstart click popupclose",this.fadeOut,this);e.on("dragstart click",this._removeTransition,this);this._reset()},onRemove:function(e){e.getPanes().overlayPane.removeChild(this._overlay);e.off("viewreset",this._reset,this)},addTo:function(e){e.addLayer(this);return this},setOpacity:function(e){this.options.opacity=e;this._updateOpacity();return this},fadeIn:function(){this.setOpacity(1).moveToPoint()._addTransition();console.log("fade in");return this},fadeOut:function(){this.setOpacity(0);console.log("fade out");return this},moveToPoint:function(){var e=this._map.latLngToLayerPoint(this._map.currentPoint);this._moveToPoint(e);return this},_addTransition:function(){L.DomUtil.addClass(this._overlay,"add-transition")},_removeTransition:function(){L.DomUtil.removeClass(this._overlay,"add-transition")},_moveToPoint:function(e){L.DomUtil.setPosition(this._overlay,e);return this},_initOverlay:function(){this._overlay=L.DomUtil.create("div","leaflet-focus-overlay");this._overlay.top=L.DomUtil.create("div","overlay-top",this._overlay);this._overlay.middle=L.DomUtil.create("div","overlay-middle",this._overlay);this._overlay.middle.left=L.DomUtil.create("div","overlay-left",this._overlay.middle);this._overlay.image=L.DomUtil.create("img","overlay-center",this._overlay.middle);this._overlay.middle.right=L.DomUtil.create("div","overlay-right",this._overlay.middle);this._overlay.bottom=L.DomUtil.create("div","overlay-bottom",this._overlay);this._map.options.zoomAnimation&&L.Browser.any3d?L.DomUtil.addClass(this._overlay,"leaflet-zoom-animated"):L.DomUtil.addClass(this._overlay,"leaflet-zoom-hide");this._updateOpacity();L.Util.extend(this._overlay.image,{galleryimg:"no",onselectstart:L.Util.falseFn,onmousemove:L.Util.falseFn,onload:L.Util.bind(this._onOverlayLoad,this),src:this._url});this._overlay.image.style.width=this._size.x+"px";this._overlay.image.style.height=this._size.y+"px"},_getViewCenter:function(){this._map.viewCenter=this._map.getCenter()},_reset:function(){L.DomUtil.setPosition(this._overlay,this._map.latLngToLayerPoint(this._map.getCenter()))},_setViewToPopup:function(e){var t=e.popup._latlng.lat,n=e.popup._latlng.lng,r=new L.LatLng(t,n);this._map.setView(r,this._map.getZoom());this._map.currentPoint=r},_onOverlayLoad:function(){this.fire("load")},_updateOpacity:function(){L.DomUtil.setOpacity(this._overlay,this.options.opacity)}});L.focusOverlay=function(e,t,n){return new L.FocusOverlay(e,t,n)};